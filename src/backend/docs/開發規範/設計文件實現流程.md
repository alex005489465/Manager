# 設計文件實現流程

## 📋 文件目的

本文件定義如何解讀設計文件並嚴格按照規範實現後端功能，確保實現與設計完全一致。

## 🎯 核心原則

> **規範至上：** 設計文件是實現的絕對基準，不允許任何偏離或自主修改。  
> **精確引用：** 每個實現都必須標註對應的設計文件來源，確保可追溯性。  
> **偏差監控：** 建立持續對照機制，及時發現和處理實現偏差。

## 📄 設計文件類型

開發時會收到四份設計文件：

1. **模型與驗證文件** - 定義實體模型和業務驗證規則
2. **資料庫設計文件** - 定義表結構和關聯關係 (由其他部分建立)
3. **API設計文件** - 定義接口規格和格式 (必須嚴格遵循)
4. **使用者流程文件** - 定義業務流程和邏輯

## 🔍 文件解讀順序

**建議按以下順序解讀文件：**

1. **使用者流程文件** → 了解整體業務邏輯和操作流程
2. **模型與驗證文件** → 理解資料結構和業務規則  
3. **資料庫設計文件** → 了解資料存儲結構和關聯關係
4. **API設計文件** → 了解對外接口規格和格式要求

*順序邏輯：業務邏輯 → 資料模型 → 資料存儲 → 接口實現*

## 🚀 完整實現流程

### 第1階段：規範文件解讀
- 按上述順序深度理解四份設計文件
- 識別關鍵業務規則和技術約束
- 記錄不明確或可能衝突的地方

### 第2階段：實現結構規劃
- 規劃技術實現架構 (Controller-Service-Repository層次)
- **建立設計文件引用標註** - 每個規劃項目標註來源文件與具體位置
- 設計測試方案 (規範驗證驅動測試)
- 制定偏差監控機制

### 第3階段：對照驗證
- 確保技術規劃與設計文件完全一致
- 識別可能的實現風險點
- 建立規範符合性檢查清單

### 第4階段：編碼實現
- 按照規劃進行實際開發
- 每個實現都標註設計文件引用

### 第5階段：偏差監控
- 持續對照規範，識別和處理偏差
- 執行規範符合性測試
- 記錄和處理發現的問題

> **參考文件：** 具體實現原則請參考 `開發原則與規範.md` 和 `測試策略與偏差處理.md`

## 🔗 設計文件引用標註機制

### 標註格式規範
每個實現項目都必須標註其設計文件來源：
```
// @Spec: [文件名稱]:[行號] - [具體內容描述]
```

### 規劃階段引用範例
```markdown
## 實現規劃：Recipe 實體

### Entity 設計
- **欄位定義:** 
  - `id: Long` // @Spec: model-validation.md:23 - Recipe主鍵定義
  - `name: String` // @Spec: model-validation.md:24-26 - 配方名稱，1-100字元限制
  - `description: String` // @Spec: model-validation.md:27-29 - 配方描述，可選欄位
  
### API Controller 設計  
- **創建配方接口:**
  - `POST /api/recipe/create` // @Spec: api-design.md:45-52 - 創建配方API規格
  - 請求參數: `CreateRecipeRequest` // @Spec: api-design.md:53-58 - 請求參數定義
  - 回應格式: `ApiResponse<Recipe>` // @Spec: api-design.md:59-65 - 標準回應格式

### 業務流程實現
- **配方創建流程:** // @Spec: user-flow.md:102-115 - 完整配方創建使用者流程
  1. 參數驗證 // @Spec: model-validation.md:30-35 - 配方創建驗證規則
  2. 業務邏輯處理 // @Spec: user-flow.md:108-112 - 配方創建業務邏輯
  3. 資料庫儲存 // @Spec: database-design.md:67-70 - Recipe表結構定義
```

### 程式碼實現引用範例

**Entity 實現 (含引用標註):**
```java
/**
 * Recipe 實體類
 * @Spec: model-validation.md:20-45 - Recipe模型完整定義
 */
@Entity
@Table(name = "recipes") // @Spec: database-design.md:67 - 表名定義
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class Recipe {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id; // @Spec: model-validation.md:23 - 主鍵定義
    
    @Column(nullable = false)
    @NotBlank(message = "配方名稱不能為空") // @Spec: model-validation.md:24-26 - 名稱驗證規則
    @Size(min = 1, max = 100) // @Spec: model-validation.md:25 - 長度限制規範
    private String name;
    
    @Size(max = 500) // @Spec: model-validation.md:27-29 - 描述長度限制
    private String description;
}
```

**API Controller 實現 (含引用標註):**
```java
/**
 * Recipe API 控制器
 * @Spec: api-design.md:40-80 - Recipe相關API完整定義
 */
@RestController
@RequestMapping("/api") // @Spec: api-design.md:15 - API根路徑定義
public class RecipeController {
    
    /**
     * 創建配方API
     * @Spec: api-design.md:45-65 - 創建配方API完整規格
     */
    @PostMapping("/recipe/create") // @Spec: api-design.md:45 - API路徑定義
    public ResponseEntity<ApiResponse> createRecipe(
        @RequestBody @Valid CreateRecipeRequest request // @Spec: api-design.md:53-58 - 請求參數定義
    ) {
        // 業務邏輯實現 @Spec: user-flow.md:102-115 - 配方創建流程
        Recipe result = recipeService.createRecipe(request);
        
        // 回應格式 @Spec: api-design.md:59-65 - 標準回應格式定義
        return ResponseEntity.ok(ApiResponse.success(result));
    }
}
```

**請求物件實現 (含引用標註):**
```java
/**
 * 創建配方請求物件
 * @Spec: api-design.md:53-58 - 請求參數完整定義
 */
public class CreateRecipeRequest {
    @NotBlank // @Spec: model-validation.md:24 - 名稱必填驗證
    @Size(min = 1, max = 100) // @Spec: model-validation.md:25 - 名稱長度限制
    private String name;
    
    @Size(max = 500) // @Spec: model-validation.md:28 - 描述長度限制
    private String description;
}
```

## 🔧 實現規範要求

### 模型與驗證實現
- 每個驗證註解都要標註對應的規範文件位置
- 自定義驗證器需註明業務規則來源
- 錯誤訊息必須使用規範文件中的精確用詞

### API 嚴格實現
- **100%按照設計文件實現** - 不得更改接口定義
- 請求參數、回應格式必須完全一致
- 錯誤回應格式必須符合設計文件規範

### 業務流程實現
- 完全按照使用者流程文件定義的步驟實現
- 不允許增加、刪除或修改業務流程步驟
- 所有業務規則都必須有對應的規範文件支撐

## 🚫 與設計文件不符時的處理流程

### 發現問題時的處理步驟
1. **停止實現** - 立即停止相關功能開發
2. **記錄問題** - 詳細記錄問題和疑問
3. **回報設計方** - 向設計文件提供方確認
4. **等待澄清** - 獲得明確答覆後再繼續開發
5. **更新文件** - 確認是否需要更新設計文件

### 常見問題類型
- API參數與業務邏輯不符
- 資料庫結構與業務需求衝突
- 驗證規則不明確或過於嚴格
- 業務流程步驟缺失或矛盾

## 🔍 引用標註的審查與維護

### 審查要點
1. **完整性檢查:** 每個實現都必須有對應的 `@Spec` 標註
2. **準確性驗證:** 標註的文件和行號必須準確對應
3. **一致性確認:** 實現內容與引用的規範條目完全一致
4. **可追溯性:** 能夠快速從實現定位到原始規範

### 維護機制
- 設計文件更新時，同步更新所有相關的 `@Spec` 標註
- 定期檢查標註的文件路徑和行號是否仍然有效
- 建立自動化工具檢查引用標註的完整性

### 標註品質要求
- 行號範圍盡量精確 (如: `23-26` 而非 `20-30`)
- 描述簡潔明瞭，突出關鍵規範要求
- 避免重複標註，一個規範點只標註一次

## 📊 品質保證

### 實現品質指標
- ✅ 100% 規範覆蓋率：所有實現都能對應到規範條目
- ✅ 100% 引用標註：每個關鍵實現都有 `@Spec` 標註
- ✅ 零超範圍功能：沒有任何規範外的功能實作
- ✅ 嚴格邊界遵守：所有數值限制完全按規範設定

### 協作效果指標
- ✅ 跨組一致性：與前端、資料庫團隊實作完全一致
- ✅ 溝通效率：減少因理解差異導致的溝通成本
- ✅ 集成順暢：各模組間介面完美匹配
- ✅ 維護便利：規範更新能快速同步到實作

---

**版本：** v1.0.0  
**建立日期：** 2025-09-07  
**狀態：** ✅ 設計文件實現流程制定完成  
**適用範圍：** 所有後端開發工作  
**維護責任：** 後端開發團隊