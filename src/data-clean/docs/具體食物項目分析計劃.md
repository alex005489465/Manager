# 具體食物項目分析計劃

## 專案背景

在完成食物相關性判別後，我們已成功識別出 284 則與食物相關的評論。現在需要進一步分析這些評論，判別其中是否提到具體的食物項目或店家，以便：

1. **提取具體商業洞察**：了解顧客對特定料理或攤位的評價
2. **識別熱門料理**：找出被頻繁提及的食物項目
3. **店家經營分析**：分析特定攤位或店家的評價趨勢
4. **精準化行銷建議**：針對具體料理提供改善建議

## 分析目標

### 主要目標
將 284 則食物相關評論進一步分類為：
- **具體食物提及**：明確提到特定料理、店家、攤位的評論
- **泛指性評論**：只含一般性描述（好吃、便宜等）的評論

### 具體判別標準

#### ✅ 具體提及（標記為 TRUE）
- **特定料理名稱**：牛肉麵、臭豆腐、雞排、大腸包小腸等
- **店家名稱**：特定攤位名稱或招牌
- **攤位描述**：如「第三排第五攤」、「轉角那家」等
- **特定食材描述**：豬血糕、花枝丸、蔥抓餅等
- **口味細節**：麻辣、清淡、酸甜等具體描述

#### ❌ 泛指評論（標記為 FALSE）
- **一般性形容**：好吃、便宜、不錯、還可以
- **籠統描述**：食物、東西、小吃
- **價格泛指**：便宜、貴、划算（未提及具體食物）
- **環境評論**：雖在食物相關評論中，但主要討論環境

## 技術實現方案

### 資料庫設計

#### 新增欄位
```sql
ALTER TABLE review_analysis
ADD COLUMN has_specific_food_mention BOOLEAN DEFAULT NULL
COMMENT '是否提到具體食物項目或店家（NULL=未判別, TRUE=有具體提及, FALSE=僅泛指）';
```

#### 索引優化
```sql
-- 單一欄位索引
CREATE INDEX idx_review_analysis_specific_food ON review_analysis(has_specific_food_mention);

-- 複合索引
CREATE INDEX idx_review_analysis_project_food ON review_analysis(is_project_related, has_specific_food_mention);
```

### Prompt 設計策略

#### 批次處理 Prompt 模板
```
請判斷以下食物相關評論是否提到具體的食物項目或店家。

判別標準：
- 具體提及：特定料理名稱、店家名稱、攤位描述、特定食材或口味描述
- 泛指評論：只提到「好吃」、「便宜」、「不錯」等一般性描述

評論1：「{content1}」
評論2：「{content2}」
...

請按順序回答（只要數字和答案）：
1. Yes/No
2. Yes/No
...
```

#### 設計考量
1. **明確判別標準**：清楚定義具體提及與泛指的差異
2. **批次處理優化**：延續之前成功的批次處理模式
3. **容錯機制**：批次失敗時自動回退到逐則處理
4. **可調整性**：Prompt 設計預留修改空間

### 處理流程設計

#### 階段一：環境準備
1. **執行 SQL 腳本**：新增 `has_specific_food_mention` 欄位
2. **驗證資料庫結構**：確認欄位和索引正確建立
3. **檢查待處理資料**：確認有 284 則食物相關評論待分析

#### 階段二：批次分析處理
1. **篩選處理對象**：
   ```sql
   SELECT id, content
   FROM review_analysis
   WHERE is_project_related = TRUE
       AND has_specific_food_mention IS NULL
   ```

2. **批次處理設定**：
   - 批次大小：15 則評論
   - 批次數量：約 19 批次
   - 處理時間：預計 2-3 分鐘

3. **處理邏輯**：
   - 成功：更新 `has_specific_food_mention` 欄位
   - 失敗：回退到逐則處理
   - 進度：即時顯示處理狀況

#### 階段三：結果驗證與分析
1. **統計分析**：
   ```sql
   SELECT
       CASE
           WHEN is_project_related = FALSE THEN '非食物相關'
           WHEN has_specific_food_mention = TRUE THEN '具體食物提及'
           WHEN has_specific_food_mention = FALSE THEN '泛指食物評論'
           ELSE '未分類'
       END as category,
       COUNT(*) as count
   FROM review_analysis
   GROUP BY category;
   ```

2. **品質驗證**：
   - 隨機抽樣人工檢查
   - 確認分類準確性
   - 記錄邊界案例

## 預期成果與應用

### 預期分類結果
基於經驗估算：
- **具體食物提及**：約 150-200 則評論 (53-70%)
- **泛指食物評論**：約 80-130 則評論 (30-47%)

### 後續分析價值

#### 1. 料理熱門度分析
- 統計最常被提及的料理類型
- 分析不同料理的評價分布
- 識別夜市特色美食

#### 2. 店家經營洞察
- 提取有店家名稱的評論
- 分析特定攤位的顧客反饋
- 提供經營改善建議

#### 3. 美食地圖建構
- 結合位置資訊（如有）
- 建立夜市美食分布圖
- 推薦最受歡迎的攤位

#### 4. 行銷策略制定
- 針對具體料理制定推廣策略
- 識別需要改善的料理項目
- 發掘潛在的熱門料理

## 技術風險與應對

### 潛在挑戰
1. **判別邊界模糊**：某些評論可能同時包含具體和泛指內容
2. **地方用語**：夜市特有的食物名稱或俚語
3. **繁體中文處理**：確保 Gemini 能正確理解台灣用語

### 應對策略
1. **Prompt 優化**：根據初步結果調整判別標準
2. **人工驗證**：對模糊案例進行人工標記
3. **迭代改善**：根據驗證結果持續優化

## 執行時程

### 快速執行版（1-2 小時）
1. **30 分鐘**：執行 SQL 腳本，準備環境
2. **30 分鐘**：實作分析邏輯
3. **30 分鐘**：執行批次處理
4. **30 分鐘**：結果驗證和報告生成

### 完整執行版（1-2 天）
1. **第 1 天上午**：環境準備和邏輯實作
2. **第 1 天下午**：執行處理和初步驗證
3. **第 2 天上午**：人工驗證和 Prompt 優化
4. **第 2 天下午**：重新處理和最終報告

## 成功指標

### 量化指標
- **處理完成率**：≥95% 的評論成功分類
- **處理效率**：批次處理成功率 ≥80%
- **時間效率**：總處理時間 ≤5 分鐘

### 質化指標
- **分類準確性**：人工驗證準確率 ≥90%
- **實用性**：能提取出有商業價值的具體料理評論
- **可擴展性**：方法可應用於未來新增的評論資料

## 檔案結構

```
src/data-clean/
├── docs/
│   ├── sql/
│   │   └── 04-add-specific-food-column.sql    # 資料庫欄位新增腳本
│   ├── 具體食物項目分析計劃.md                  # 本計劃文檔
│   └── 具體食物項目分析結果報告.md              # 待生成的結果報告
├── specific_food_analyzer.py                   # 主要分析腳本
├── config.py                                   # 資料庫配置（既有）
└── .env                                        # 環境變數（既有）
```

## 總結

此分析計劃將食物相關評論的價值進一步提升，從泛指的「食物相關」深入到「具體料理提及」，為夜市經營者和管理者提供更精準的商業洞察。透過技術手段的自動化處理，我們能夠快速且準確地完成大量評論的細分分析，為後續的深度洞察分析奠定堅實基礎。