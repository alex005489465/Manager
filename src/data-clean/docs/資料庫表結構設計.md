# 資料庫表結構設計文檔

## 概述
設計兩張表來存儲永大夜市Google Maps評論資料，將搜尋元數據與評論內容分離。
遵循專案無約束設計原則：統一主鍵、零約束、應用程式負責資料完整性。

## 表結構設計

### 1. search_metadata 表 - 搜尋元數據
```sql
CREATE TABLE search_metadata (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    search_id VARCHAR(50),
    google_maps_reviews_url TEXT,
    data_id VARCHAR(100),
    title VARCHAR(200),
    address TEXT,
    rating DECIMAL(2,1),
    reviews INTEGER
);
```

**欄位說明：**
- `id`: 統一自增主鍵
- `search_id`: 搜尋業務識別碼
- `google_maps_reviews_url`: Google Maps評論頁面URL
- `data_id`: Google Maps地點的data_id
- `title`: 地點名稱
- `address`: 地點地址
- `rating`: 地點平均評分
- `reviews`: 評論總數

### 2. reviews 表 - 評論內容
```sql
CREATE TABLE reviews (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    review_id VARCHAR(100),
    search_id VARCHAR(50),
    rating DECIMAL(2,1),
    snippet TEXT,
    link TEXT,
    iso_date TIMESTAMP,
    iso_date_of_last_edit TIMESTAMP
);
```

**欄位說明：**
- `id`: 統一自增主鍵
- `review_id`: 評論業務識別碼
- `search_id`: 關聯搜尋記錄的業務識別碼（無約束）
- `rating`: 評論評分
- `snippet`: 評論文字內容
- `link`: 評論連結
- `iso_date`: 評論發布日期
- `iso_date_of_last_edit`: 評論最後編輯日期

## 資料對應關係

### JSON 原始資料對應
**search_metadata 表：**
- `google_maps_reviews_url` ← `search_metadata.google_maps_reviews_url`
- `data_id` ← `search_parameters.data_id`
- `title` ← `place_info.title`
- `address` ← `place_info.address`
- `rating` ← `place_info.rating`
- `reviews` ← `place_info.reviews`

**reviews 表：**
- `review_id` ← `reviews[].review_id`
- `rating` ← `reviews[].rating`
- `snippet` ← `reviews[].snippet`
- `link` ← `reviews[].link`
- `iso_date` ← `reviews[].iso_date`
- `iso_date_of_last_edit` ← `reviews[].iso_date_of_last_edit`

## 表關聯設計
- 業務關聯：`reviews.search_id` ↔ `search_metadata.search_id`
- 一對多關係：一次搜尋對應多條評論
- 查詢策略：通過 search_id 關聯兩表數據
- **無約束原則**：不使用外鍵約束，關聯完整性由應用程式負責

## 索引建議（效能優化）
```sql
-- 針對常用查詢欄位建立索引
CREATE INDEX idx_reviews_search_id ON reviews(search_id);
CREATE INDEX idx_reviews_review_id ON reviews(review_id);
CREATE INDEX idx_search_metadata_search_id ON search_metadata(search_id);
CREATE INDEX idx_reviews_iso_date ON reviews(iso_date);
```

## 資料處理流程
1. 提取 search_metadata、place_info 存入 search_metadata 表
2. 遍歷 reviews 陣列，每條評論存入 reviews 表
3. 使用相同的 search_id 建立業務關聯
4. 應用程式負責維護資料完整性