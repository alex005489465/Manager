# 使用 Gemini 2.5 Flash-Lite 實現食物相關性判別計劃

## 目標

對 `review_analysis` 表中的評論進行食物相關性判別，更新 `is_project_related` 欄位：
- **TRUE**：與食物相關的評論（提到食物、菜品、口味、價格、份量等）
- **FALSE**：與環境、設施、管理等非食物相關的評論

這樣可以篩選出對夜市管理更有價值的非食物評論，為後續管理議題分析奠定基礎。

## 技術方案：Gemini 2.5 Flash-Lite API

### 選擇理由

1. **成本極低**
   - 免費層級：完全免費的輸入和輸出
   - 付費層級：約台幣 0.5 元處理 3000 則評論

2. **處理速度快**
   - 優化過的輕量級模型
   - 專為低延遲使用場景設計

3. **準確度高**
   - 食物相關性判別對 LLM 來說是相對簡單的任務
   - 二元判斷（Yes/No）降低錯誤率

4. **中文支援**
   - Google 官方支援中文
   - 適合處理繁體中文夜市評論

### 成本估算

針對永大夜市約 3000 則評論：
- **輸入**：Prompt + 評論內容，約 100 tokens × 3000 = 30萬 tokens
- **輸出**：Yes/No 回答，約 1 token × 3000 = 3000 tokens
- **免費層級**：完全免費
- **付費層級（批次模式）**：約 $0.016 美元（不到台幣 0.5 元）

## Prompt 設計

### 最終版本 Prompt

```
請判斷以下夜市評論是否與食物相關。
如果提到食物、菜品、口味、價格、份量等，回答 "Yes"
如果只談論環境、設施、管理、服務等，回答 "No"

評論：「{content}」

回答：
```

### 設計原則

1. **簡潔明確**：清楚定義判別標準
2. **二元選擇**：只要求 Yes/No 回答，降低複雜度
3. **中文友善**：使用繁體中文說明
4. **範例導向**：明確說明食物相關和非食物相關的特徵

## 實現步驟

### 階段一：建立簡化版判別腳本

1. **建立單一 Python 腳本** (`food_relevance_checker.py`)
   - 參考現有的 `import_data.py` 和 `verify_data.py` 模式
   - 使用現有的 `config.py` 連接資料庫
   - 整合 Gemini API 呼叫功能

2. **基本功能實現**
   - 從 review_analysis 表讀取評論
   - 使用簡單的 Prompt 呼叫 Gemini API
   - 將 Yes/No 結果更新到 is_project_related 欄位
   - 如果失敗就停止，不做複雜的錯誤處理

### 階段二：測試與執行

1. **測試腳本功能**
   - 確認 Gemini API 連接正常
   - 測試資料庫讀寫功能
   - 驗證 Prompt 回應解析

2. **執行處理**
   - 運行腳本處理所有評論
   - 監控處理進度
   - 記錄基本統計資訊

### 階段三：結果驗證

1. **統計分析**
   - 查看食物相關 vs 非食物相關評論比例
   - 檢查處理結果的合理性

2. **抽樣驗證**
   - 人工檢查少量結果確認準確性
   - 如有問題可重新調整 Prompt 再次處理

## 預期產出

### 主要成果

1. **完整填充的資料庫**
   - 所有 `review_analysis` 記錄的 `is_project_related` 欄位都有明確值
   - 為後續分析提供清晰的資料基礎

2. **可重複使用的工具**
   - 模組化的判別程式
   - 可用於處理新增的評論資料
   - 支援不同的判別標準調整

3. **詳細的分析報告**
   - 食物相關性分布統計
   - 處理效率和準確性評估
   - 非食物相關評論的初步分類

### 後續應用價值

1. **管理議題分析**
   - 專注分析非食物相關的評論
   - 提取夜市管理改善建議
   - 識別基礎設施和服務問題

2. **數據品質提升**
   - 為決策分析提供更精準的資料
   - 減少不相關資訊的干擾
   - 提高後續分析的針對性

3. **流程標準化**
   - 建立評論分類的標準流程
   - 為其他地點或時期的資料處理提供範本
   - 累積夜市評論分析的經驗和方法

## 技術架構

### 檔案結構

```
src/data-clean/
├── food_relevance_checker.py       # 食物相關性判別腳本
├── config.py                       # 現有的資料庫配置
└── .env                            # 環境變數（需包含 GEMINI_API_KEY）
```

### 環境需求

- Python 3.8+
- Google Generative AI SDK
- MySQL Connector
- python-dotenv
- Gemini API Key

## 風險評估與應對

### 潛在風險

1. **API 限制**
   - 免費層級可能有使用量限制
   - 應對：監控使用量，必要時升級付費層級

2. **網路穩定性**
   - API 呼叫可能因網路問題失敗
   - 應對：實現重試機制和進度保存

3. **判別準確性**
   - LLM 可能對某些評論判別錯誤
   - 應對：人工抽樣驗證和 Prompt 優化

### 品質保證措施

1. **分階段實施**：小規模測試 → 優化調整 → 全量處理
2. **多重驗證**：自動判別 + 人工抽查 + 統計分析
3. **可回溯性**：保留處理日誌和原始資料備份

## 時程規劃

- **步驟 1**：建立判別腳本（已完成）
- **步驟 2**：測試腳本功能
- **步驟 3**：執行全量處理
- **步驟 4**：驗證結果

預計 1-2 小時內完成整個流程。