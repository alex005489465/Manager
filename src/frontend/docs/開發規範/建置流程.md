# 建置與開發流程

## 決議：容器化開發 + 自動化品質檢查

### 開發流程（基於現有 Docker 配置）

```bash
# 1. 啟動開發環境
cd ../../../infra/development
docker-compose up -d node-dev

# 2. 開發指令
docker exec pet_workshop_node_dev npm install  # 安裝依賴
docker exec pet_workshop_node_dev npm run dev  # 開發服務器
docker exec pet_workshop_node_dev npm test     # 執行測試
docker exec pet_workshop_node_dev npm run lint # 程式碼檢查
docker exec pet_workshop_node_dev npm run build # 生產建置
```

### Git Hooks 配置建議

```json
// package.json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged",
      "pre-push": "npm run test && npm run build"
    }
  },
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write",
      "vitest related --run --passWithNoTests"
    ]
  }
}
```

### CI/CD Pipeline 建議（多階段驗證）

```yaml
# .github/workflows/frontend.yml
name: Frontend CI/CD

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '24'
      
      # 階段 1：程式碼品質檢查
      - run: npm ci
      - run: npm run lint
      - run: npm run type-check
      
      # 階段 2：測試執行
      - run: npm test -- --coverage
      - run: npm run test:e2e  # 如有 E2E 測試
      
      # 階段 3：建置驗證
      - run: npm run build
      - run: npm run preview  # 建置結果驗證

  deploy:
    needs: test
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - run: echo "部署到生產環境"
```

### 環境變數管理（分層配置）

```typescript
// config/env.ts
interface AppConfig {
  API_BASE_URL: string;
  APP_ENV: 'development' | 'staging' | 'production';
  DEBUG_MODE: boolean;
}

const config: AppConfig = {
  API_BASE_URL: import.meta.env.VITE_API_BASE_URL || 'http://localhost:8080',
  APP_ENV: (import.meta.env.MODE as AppConfig['APP_ENV']) || 'development',
  DEBUG_MODE: import.meta.env.DEV,
};

// .env.development
VITE_API_BASE_URL=http://localhost:8080
VITE_DEBUG_MODE=true

// .env.production
VITE_API_BASE_URL=https://api.production.com
VITE_DEBUG_MODE=false
```

### 建置優化配置

```typescript
// vite.config.ts
export default defineConfig({
  build: {
    target: 'es2020',
    minify: 'terser',
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          antd: ['antd'],
          redux: ['@reduxjs/toolkit', 'react-redux'],
        },
      },
    },
  },
  server: {
    port: 3000,
    strictPort: true,  // 嚴格端口控制
    host: '0.0.0.0',   // Docker 容器內訪問
  },
});
```

## 開發品質指標

### 規範符合性指標

- ✅ **100% 規範覆蓋率：** 所有實作都能對應到規範條目
- ✅ **零超範圍功能：** 沒有任何規範外的功能實作
- ✅ **嚴格邊界遵守：** 所有數值限制完全按規範設定
- ✅ **完整創意記錄：** 所有額外想法都記錄在案

### 協作效果指標

- ✅ **跨組一致性：** 前後端實作完全一致
- ✅ **溝通效率：** 減少因理解差異導致的溝通成本
- ✅ **集成順暢：** 各模組間介面完美匹配
- ✅ **維護便利：** 規範更新能快速同步到實作

### 品質門檻設定

- **程式碼覆蓋率：** 80% 以上才允許合併
- **ESLint：** 0 錯誤，警告不超過 5 個
- **TypeScript：** 嚴格模式，0 型別錯誤
- **建置：** 必須成功建置才能部署
- **規範驗證：** 通過規範符合性檢查
- **偏差處理：** 所有已知偏差都有處理記錄

### 品質監控機制

#### 即時品質監控
- **每次提交：** 自動執行品質檢查
- **每次合併：** 執行完整的品質驗證
- **每日建置：** 生成品質報告
- **週期審查：** 定期回顧品質指標

#### 品質報告內容
```typescript
interface QualityReport {
  // 規範符合性
  specificationCoverage: number;    // 規範覆蓋率
  outOfScopeFeatures: number;      // 超範圍功能數量
  boundaryViolations: number;      // 邊界違規數量
  
  // 程式碼品質
  testCoverage: number;            // 測試覆蓋率
  eslintErrors: number;            // ESLint 錯誤數量
  typeErrors: number;              // TypeScript 錯誤數量
  
  // 偏差追蹤
  activeDeviations: number;        // 活躍偏差數量
  resolvedDeviations: number;      // 已解決偏差數量
  
  // 協作指標
  crossTeamConsistency: number;    // 跨團隊一致性分數
  communicationEfficiency: number; // 溝通效率分數
}
```

### 品質改進流程

#### 問題識別機制
1. **自動檢測：** CI/CD 流程中的自動品質檢查
2. **人工審查：** Code Review 中的人工品質審查
3. **測試發現：** 測試執行中發現的品質問題
4. **使用回饋：** 使用者回饋中的品質問題

#### 改進執行步驟
1. **問題分析：** 分析品質問題的根本原因
2. **解決方案：** 制定具體的改進措施
3. **實施改進：** 執行改進措施
4. **效果評估：** 評估改進效果並持續優化
5. **知識總結：** 將經驗總結為可重用的知識

### Package Scripts 標準化

```json
{
  "scripts": {
    "start": "vite",
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "lint:fix": "eslint . --ext ts,tsx --fix",
    "type-check": "tsc --noEmit",
    "format": "prettier --write \"src/**/*.{ts,tsx,json,css,md}\"",
    "analyze": "npm run build && npx vite-bundle-analyzer dist/assets"
  }
}
```

### 開發環境配置檢查清單

#### 容器環境
- [ ] Docker 容器正常運行
- [ ] 端口 3000 可用且未被佔用
- [ ] 工作目錄正確掛載
- [ ] Node.js 版本符合要求（24.5.0）

#### 依賴管理
- [ ] package.json 版本一致
- [ ] node_modules 正常安裝
- [ ] 版本鎖定檔案存在（package-lock.json）

#### 開發工具
- [ ] ESLint 配置生效
- [ ] Prettier 格式化正常
- [ ] TypeScript 編譯無錯誤
- [ ] Vite HMR 熱更新工作
- [ ] Redux DevTools 連接成功

### 部署準備

#### 建置前檢查
1. 所有測試通過
2. 程式碼品質檢查通過
3. 型別檢查無錯誤
4. 環境變數正確配置

#### 建置產物驗證
1. 建置檔案大小合理
2. 靜態資源路徑正確
3. 預覽功能正常運行
4. 無 console 錯誤或警告

### 監控與維護

- **建置時間監控：** 追蹤建置效能變化
- **Bundle 大小分析：** 定期檢查檔案大小
- **依賴安全掃描：** 檢查第三方套件漏洞
- **效能指標監控：** 追蹤應用載入速度