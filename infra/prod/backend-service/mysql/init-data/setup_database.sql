-- Manager 專案資料庫使用者和權限設定
-- 此腳本用於建立專案專用的使用者和資料庫，並設定適當的權限
-- 執行方式：在 MySQL 中以 root 身份執行此腳本

-- =================================================================
-- 1. 建立專案主資料庫
-- =================================================================
CREATE DATABASE IF NOT EXISTS manager_db
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

-- =================================================================
-- 2. 建立專案使用者
-- =================================================================
-- 建立專用使用者（替換為安全密碼）
CREATE USER IF NOT EXISTS 'manager_user'@'%' IDENTIFIED BY 'manager_secure_password';

-- =================================================================
-- 3. 授予資料庫權限
-- =================================================================
-- 對 manager_db 授予完整權限（專案主資料庫）
GRANT ALL PRIVILEGES ON manager_db.* TO 'manager_user'@'%';

-- 對 manager_reviews_db 授予讀寫權限（外部現有資料庫，不做修改）
-- 注意：manager_reviews_db 已存在，僅授權不建立
GRANT SELECT, INSERT, UPDATE ON manager_reviews_db.* TO 'manager_user'@'%';

-- =================================================================
-- 4. 重新載入權限
-- =================================================================
FLUSH PRIVILEGES;

-- =================================================================
-- 5. 驗證設定結果
-- =================================================================
-- 查看建立的資料庫
SHOW DATABASES LIKE 'manager%';

-- 查看使用者權限
SHOW GRANTS FOR 'manager_user'@'%';

-- =================================================================
-- 使用說明
-- =================================================================
-- 1. 執行前請確保 manager_reviews_db 已存在
-- 2. 請將 'manager_secure_password' 替換為實際的安全密碼
-- 3. 執行後請更新 application.yml 中的資料庫連線設定
-- 4. 建議在生產環境中使用更嚴格的主機限制（替換 '%' 為具體 IP）