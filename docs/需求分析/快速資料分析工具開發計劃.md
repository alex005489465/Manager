# 快速資料分析工具開發計劃

## 專案背景

基於已完成的餐廳評論蒐集與分類系統，現需開發簡單快速的資料分析工具，將現有的結構化數據轉化為可用的商業洞察。

## 現有資料架構

### 現有資料庫和資料說明
**重要**：本專案使用現有的 MySQL 資料庫和已處理完成的資料
- **資料庫**：`manager_reviews_db` (已建立)
- **資料**：所有評論收集、分類、結構化提取均已完成
- **分析目標**：從現有資料中發現商機，不產生新資料

### 核心分析資料集
**分析重點**：`extracted_food_items` + `reviews.rating`

**資料關聯路徑**：
```
extracted_food_items.review_id → review_analysis.id → review_analysis.review_id → reviews.id → reviews.rating
```

### 最終分析欄位
- **dish_name**：料理名稱
- **vendor_name**：店家名稱
- **price**：價格資訊
- **rating_sentiment**：AI 分析的情感傾向
- **data_completeness**：資料完整度
- **rating**：使用者實際評分 (1-5 星) ← 關聯取得

### 分析策略
1. **第一步**：建立核心資料集 (extracted_food_items + rating)
2. **第二步**：基於此資料集進行各種分析
3. **review_analysis 表僅作為關聯中介，不參與實際分析**

## 開發計劃

### 第一優先：基礎統計分析腳本 (1-2天完成)

#### 1. 核心資料集建立模組
**功能**：
- 執行多表關聯查詢，建立核心分析資料集
- 資料清理和驗證
- 匯出核心資料集供後續分析使用

**核心資料集 SQL**：
```sql
SELECT
    e.dish_name,
    e.vendor_name,
    e.price,
    e.rating_sentiment,
    e.data_completeness,
    r.rating
FROM extracted_food_items e
JOIN review_analysis ra ON e.review_id = ra.id
JOIN reviews r ON ra.review_id = r.id
WHERE r.rating IS NOT NULL
```

**商機分析 SQL 範例**：
```sql
-- 低評分數量排行榜（料理）
SELECT
    dish_name,
    COUNT(*) as total_count,
    SUM(CASE WHEN rating <= 2 THEN 1 ELSE 0 END) as low_rating_count,
    ROUND(SUM(CASE WHEN rating <= 2 THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as low_rating_ratio
FROM core_dataset
WHERE dish_name IS NOT NULL
GROUP BY dish_name
HAVING COUNT(*) >= 5  -- 最少樣本數
ORDER BY low_rating_count DESC, low_rating_ratio DESC
LIMIT 10;

-- 低評分比率排行榜（料理）
SELECT
    dish_name,
    COUNT(*) as total_count,
    SUM(CASE WHEN rating <= 2 THEN 1 ELSE 0 END) as low_rating_count,
    ROUND(SUM(CASE WHEN rating <= 2 THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as low_rating_ratio
FROM core_dataset
WHERE dish_name IS NOT NULL
GROUP BY dish_name
HAVING COUNT(*) >= 5  -- 最少樣本數
ORDER BY low_rating_ratio DESC, low_rating_count DESC
LIMIT 10;
```

**輸出**：
- 核心分析資料集 CSV
- 資料品質報告

#### 2. 商機發現分析模組（核心重點）
**功能**：

**低評分商機分析** (主要目標)：
- **低評分數量排行榜**：絕對低評分(1-2星)數量最多的料理/店家
  - 定位：市場需求大但現有品質不佳 → 有機會做出好產品搶市場
- **低評分比率排行榜**：低評分比例最高的料理/店家 (需有最低樣本數)
  - 定位：該項目/商家評價普遍很差 → 有機會提供優質替代方案

**高評分參考分析** (次要參考)：
- **高評分數量排行榜**：絕對高評分(4-5星)數量最多的料理/店家
- **高評分比率排行榜**：高評分比例最高的料理/店家
- 用途：了解市場標竿，評估競爭難度

**輸出**：
- 低評分商機清單 (料理/店家分別)
- 高評分競爭對手清單 (參考用)
- 商機評估報告

#### 3. 評分與情感分析模組
**功能**：
- 使用者評分 vs AI 情感分析對比
- 評分分布分析 (1-5 星分布)
- 高分項目特徵分析
- 低分項目特徵分析
- 評分與價格關聯性分析

**輸出**：
- 評分情感對比報告
- 評分特徵分析結果

#### 4. 視覺化模組
**功能**：

**商機發現圖表** (主要)：
- 低評分數量 TOP10 料理長條圖 (市場規模大但品質差)
- 低評分比率 TOP10 料理長條圖 (評價普遍很差)
- 低評分數量 TOP10 店家長條圖
- 低評分比率 TOP10 店家長條圖
- 商機評分散布圖 (X軸:評分數量, Y軸:低評分比率)

**參考對比圖表** (次要)：
- 高評分競爭對手分布圖
- 評分 vs AI情感分析一致性圖

**輸出**：
- PNG 格式圖表檔案
- 可互動的 HTML 圖表 (重點突出商機項目)

#### 5. 報告生成模組
**功能**：
- Markdown 格式分析報告
- Excel 試算表報告（包含多個工作表）
- 核心資料集 CSV 匯出

**輸出**：
- `food_items_analysis_report.md`
- `food_items_analysis.xlsx`
- `core_dataset.csv`

## 技術實現

### 開發環境
- **語言**：Python 3.8+
- **資料庫**：MySQL (現有的 `manager_reviews_db`)
- **核心套件**：
  - `pandas`：資料處理
  - `matplotlib`/`seaborn`：圖表生成
  - `plotly`：互動式圖表
  - `openpyxl`：Excel 匯出
  - `mysql-connector-python`：資料庫連接

### 資料庫配置範例 (config.py)
```python
DATABASE_CONFIG = {
    'host': 'localhost',         # 或實際主機 IP
    'database': 'manager_reviews_db',
    'user': 'manager_reviews_user',
    'password': 'MgrRev2024!@#',
    'port': 3306,
    'charset': 'utf8mb4',
    'autocommit': True
}
```

### 程式架構
```
src/data-analysis/
├── __init__.py
├── config.py                       # 配置設定
├── database_connector.py           # 資料庫連接
├── core_dataset_builder.py         # 核心資料集建立
├── opportunity_analyzer.py          # 商機發現分析（核心模組）
├── competitor_analyzer.py          # 競爭對手參考分析
├── rating_sentiment_validator.py   # 評分情感分析驗證
├── visualizer.py                  # 圖表生成
├── report_generator.py            # 商機報告生成
└── main.py                        # 程式入口點
```

### 執行方式
```bash
cd src/data-analysis
python main.py
```

### 資料庫連接資訊
**重要：使用現有資料庫和資料**
- **資料庫名稱**：`manager_reviews_db`
- **使用者名稱**：`manager_reviews_user`
- **密碼**：`MgrRev2024!@#`
- **Host**：localhost (或實際主機位址)
- **Port**：3306 (預設 MySQL 埠)

**注意**：所有資料表和資料都已存在，本工具僅進行查詢和分析，不會修改任何現有資料。

## 預期成果

### 輸出檔案結構
```
output/
├── charts/
│   ├── low_rating_count_dishes.png     # 低評分數量料理商機榜
│   ├── low_rating_ratio_dishes.png     # 低評分比率料理商機榜
│   ├── low_rating_count_vendors.png    # 低評分數量店家商機榜
│   ├── low_rating_ratio_vendors.png    # 低評分比率店家商機榜
│   ├── opportunity_matrix.png          # 商機矩陣圖(數量vs比率)
│   ├── high_rating_competitors.png     # 高評分競爭對手參考
│   └── rating_vs_sentiment.png         # 評分vs AI情感分析驗證
├── reports/
│   ├── business_opportunity_report.md  # 商機發現報告
│   └── opportunity_analysis.xlsx       # 商機分析試算表
└── data/
    ├── core_dataset.csv               # 核心分析資料集
    ├── dish_opportunities.csv          # 料理商機清單
    ├── vendor_opportunities.csv        # 店家商機清單
    ├── competitor_reference.csv        # 競爭對手參考清單
    └── opportunity_summary.csv         # 商機摘要分析
```

### 主要分析指標

1. **核心資料集統計**
   - 總食物項目數：X 個
   - 有評分的項目數：Y 個 (完整度：Z%)
   - 唯一料理種類：A 種
   - 唯一店家數：B 家

2. **商機發現分析（主要重點）**

   **料理商機分析**：
   - 低評分數量 TOP10：市場需求大但品質差的料理
   - 低評分比率 TOP10：評價普遍很差的料理（樣本數≥5）
   - 商機評估：低評分數量 × 低評分比率 的綜合商機指數

   **店家商機分析**：
   - 低評分數量 TOP10：客流量大但服務/品質差的店家
   - 低評分比率 TOP10：評價普遍很差的店家（樣本數≥3）
   - 替代商機：這些店家周邊的市場空白機會

3. **競爭對手參考分析（次要參考）**
   - 高評分數量 TOP10：市場領導者（料理/店家）
   - 高評分比率 TOP10：品質標竿（料理/店家）
   - 競爭難度評估：需要面對的競爭強度

4. **商業洞察摘要**
   - 最具潛力的商機料理類別（低評分多+比率高）
   - 最值得挑戰的店家市場區域
   - 建議避開的高競爭領域
   - 性價比機會分析（低評分高價格項目）

## 開發時程

| 任務 | 預估時間 | 負責人員 |
|------|----------|----------|
| 環境設定與套件安裝 | 0.5天 | 開發者 |
| 核心資料集建立模組 | 0.5天 | 開發者 |
| 食物項目分析邏輯實作 | 0.5天 | 開發者 |
| 評分情感分析模組 | 0.5天 | 開發者 |
| 視覺化圖表生成 | 0.5天 | 開發者 |
| 報告生成功能 | 0.5天 | 開發者 |
| 測試與除錯 | 0.5天 | 開發者 |

**總預估時間**：3天 (含緩衝時間)

## 開發優先順序

1. **最高優先**：核心資料集建立 - 確保能正確關聯三個表格
2. **最高優先**：商機發現分析 - 低評分數量和比率排行榜
3. **中優先**：競爭對手參考分析 - 高評分標竿了解
4. **低優先**：評分情感驗證 - AI 分析準確度檢查
5. **最低優先**：視覺化美化和報告格式優化

## 後續擴展可能

此基礎版本完成後，可考慮：
- 料理推薦系統（基於高評分項目）
- 店家競爭分析（同類料理比較）
- 價格趨勢分析
- 顧客偏好模式識別
- 自動化異常檢測（評分與情感分析不一致項目）

## 風險評估

- **低風險**：基於現有穩定的資料庫結構
- **技術風險**：多表關聯查詢效能，依賴套件相容性
- **數據風險**：關聯鍵缺失可能導致資料不完整
- **業務風險**：AI 情感分析與實際評分可能存在系統性差異

## 成功指標

**核心功能指標**：
- 成功建立 extracted_food_items + rating 核心資料集
- 關聯成功率 > 90% (有評分的食物項目比例)
- 處理時間 < 3分鐘 (核心資料集建立+商機分析)

**商機發現指標**：
- 成功識別出低評分數量 TOP10 料理/店家清單
- 成功識別出低評分比率 TOP10 料理/店家清單（樣本數篩選合理）
- 商機項目與競爭對手項目有明顯區別（重疊度 < 30%）
- 商機清單包含具體的數量和比率數據

**輸出品質指標**：
- 輸出檔案格式正確且內容完整
- 商機報告包含明確的商業建議
- 圖表清晰顯示商機排行榜和對比分析
- 數據驗證：低評分項目確實評分偏低，高評分項目確實評分較高